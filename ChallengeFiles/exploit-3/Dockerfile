FROM php:7.2-apache

RUN apt update && apt-get install -y software-properties-common
RUN apt-add-repository 'deb http://security.debian.org/debian-security stretch/updates main' && apt-get update
RUN mkdir -p /usr/share/man/man1
RUN apt install -y openjdk-8-jdk make

RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini"

# Set environment variavbles for openjdk
ENV JAVA_HOME=/usr/lib/jvm/java-1.8-openjdk
ENV PATH="$JAVA_HOME/bin:${PATH}"

# Name the server
RUN echo "ServerName gamefinder" >> /etc/apache2/apache2.conf

# Set the working directory.
WORKDIR /usr/src/gamefinder

# Copy the file from your host to your current location.
COPY . .

WORKDIR /usr/src/gamefinder/src

# Run the compile and install the gamefinder application.
RUN make install

WORKDIR /

RUN rm -rf /usr/src/gamefinder

EXPOSE 80