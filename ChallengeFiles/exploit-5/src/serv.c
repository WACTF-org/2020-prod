#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef void (*process)(void*);

typedef struct ship {
	char model[16];
	int fuel;
	process proc;
} ship;

void display_ship(void* to_proc) {
	ship* d = (ship*)to_proc;
    printf("Model: ");
    printf(d->model);
	printf(", Fuel(L): %d.\n", d->fuel);
}

ship* dock(char* model, int fuel) {
	printf("Docked %s.\n", model);
	ship* p = (ship*)malloc(sizeof(ship));
	strncpy(p->model, model, 16);
	p->fuel = fuel;
	p->proc = &display_ship;
	return p;
}

void print_ui(char* banner) {
    printf("---%s---\n", banner);
    printf("1: Dock ship\n");
    printf("2: Display ship\n");
    printf("3: Release ship\n");
    printf("4: Set Hanger Message\n");
    printf(">>> ");
}

int main(int argc, char const *argv[]) {
    setvbuf(stdin,0,2,0);
    setvbuf(stdout,0,2,0);
    char banner[32];
    strncpy(banner, "Death  Star   Hanger  Inventory", 32);
    ship* hanger[16];
    int num_docked_ships = 0;
    for(;;) {
        print_ui(banner);
        int c;
        scanf("%d", &c);

        if (c == 1) {
            printf("Enter Ship Model:\n");
            char model[16];
            int fuel;
            scanf("%16s", model);
            printf("Enter Remaining fuel(L):\n");
            scanf("%d", &fuel);
            if (num_docked_ships < 16) {
                hanger[num_docked_ships] = dock(model, fuel);
                num_docked_ships++;
            }
        }
        else if (c == 2) {
            int idx;
            printf("Enter Bay Number:\n");
            scanf("%d", &idx);
            if (idx >= 0 && idx < 16) {
                hanger[idx]->proc(hanger[idx]);
            }
            else {
                printf("Bay number too high. (MAX: 15)\n");
            }
        }
        else if (c == 3) {
            if(num_docked_ships < 1) {
                printf("Nothing docked.\n");
                continue;
            }
            int idx;
            printf("Enter Bay Number:\n");
            scanf("%d", &idx);
            if (idx >= 0 && idx < 16) {
                free(hanger[idx]);
                num_docked_ships--;
            }
            else {
                printf("Bay number too high. (MAX: 15)\n");
            }
        }
        else if (c == 4) {
            printf("Enter new Banner:\n");
            char* buf = (char*)malloc(32);
            scanf("%32s", buf);
            strncpy(banner, buf, 32);
            free(buf);
        }
    }

    return 0;
}

